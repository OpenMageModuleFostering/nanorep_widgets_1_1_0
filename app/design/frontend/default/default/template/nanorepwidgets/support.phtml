<?php
if (!is_null($this -> getProduct())) {
    $_product = $this -> getProduct();
} elseif (!is_null(Mage::registry('current_product'))) {
    $_product = Mage::registry('current_product');
} else {
    $_product = null;
}
?>

<?php if($this->helper("nanorepwidgets")->isSupportWidgetEnabled()):?>
<!--do not modify this script -->
<?php $this->getXml(true); ?>
<?php $this->getXml(); ?>
<script type='text/javascript'>

    document.observe("dom:loaded", function() {
    	if($$('<?php echo Mage::getStoreConfig("nanorepwidgets/support_widget/div_css"); ?>').length > 0){
    		$$('<?php echo Mage::getStoreConfig("nanorepwidgets/support_widget/div_css"); ?>')[0].insert("<div id='nanoRepEmbedContainer'></div>");
    		//$('nanoRepEmbedContainer').insert($$('<?php echo Mage::getStoreConfig("nanorepwidgets/support_widget/div_css"); ?>')[0].descendants()[0]);
    	}
    	else{
    		$$('.box-collateral.box-additional')[0].insert("<div id='nanoRepEmbedContainer'></div>");
    	}
        onloadFnc();    
    }); 

	var _nRepData = _nRepData || [];
	_nRepData['kb'] = '8331305';
	/* API here */;
	_nRepData['embed'] = {
		account : '<?php echo $this -> helper("nanorepwidgets") -> getAccountName(); ?>',
		container : 'nanoRepEmbedContainer',
		width : <?php echo $this -> helper("nanorepwidgets") -> getSupportWidgetWidth(); ?>,
		maxHeight : <?php echo $this -> helper("nanorepwidgets") -> getSupportWidgetMaxHeight(); ?>,
		dynamicSize : true,
		cdcFrame : '',
		cdcVersion : 3,
		scriptVersion : '2.13.1.25'
	};
	(function() {
		var windowLoadFunc = function() {
			var _nRepData = window._nRepData || [];
			_nRepData['windowLoaded'] = true;
			if ( typeof (_nRepData['windowOnload']) === 'function')
				_nRepData['windowOnload']();
		};
		if (window.attachEvent)
			window.attachEvent('onload', windowLoadFunc);
		else if (window.addEventListener)
			window.addEventListener('load', windowLoadFunc, false);
		var sc = document.createElement('script');
		sc.type = 'text/javascript';
		sc.async = true;
		sc.defer = true;
		sc.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'my.nanorep.com/widget/scripts/embed.js?account=<?php echo $this -> helper("nanorepwidgets") -> getAccountName(); ?>';
		var _head = document.getElementsByTagName('head')[0];
		_head.appendChild(sc);
	})();
</script>
<?php endif; ?>